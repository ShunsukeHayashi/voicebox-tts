# VoiceBox TTS Performance Test Plan

## 概要
VoiceBox TTSシステムの包括的な性能テスト計画

## テスト環境
- **CPU**: Apple Silicon (Mac)
- **Memory**: 現在の空きメモリ
- **Concurrency**: Celery Worker = 1 (直列実行)
- **音声速度**: 1.3倍速

## テスト項目

### Test 1: エンドツーエンド レイテンシ
**目的**: 各コンポーネントの応答時間を測定

**測定項目**:
- フック実行時間
- APIリクエスト時間
- タスク作成時間
- 音声生成時間
- 総合レイテンシ

**期待値**:
- フック: < 0.01秒
- API: < 0.05秒
- 音声生成: < 5秒

---

### Test 2: 同時実行負荷テスト
**目的**: 連続タスクの処理能力を測定

**シナリオ**:
- 10タスクを連続送信
- メインスレッドの復帰速度を測定
- バックグラウンド処理の順序を確認

**期待値**:
- 10タスク送信: < 1秒
- 直列処理: タスク順に正しく再生

---

### Test 3: メモリ使用量テスト
**目的**: 長時間稼働時のメモリ増加を測定

**シナリオ**:
- 初期状態のメモリ使用量
- 50タスク処理後のメモリ使用量
- Redisメモリ使用量

**期待値**:
- メモリリークなし
- Redis < 10MB

---

### Test 4: エラー耐性テスト
**目的**: 障害発生時のシステム挙動を確認

**シナリオ**:
- VOICEVOX APIダウン時
- APIサーバーダウン時
- Redisダウン時

**期待値**:
- フックは即座に復帰
- エラーが他タスクに波及しない

---

### Test 5: 長時間安定性テスト
**目的**: 100+タスク処理時の安定性を確認

**シナリオ**:
- 100タスクを連続送信
- 全タスクの成功確認
- ファイル数増加の確認

**期待値**:
- 全タスク成功
- 自動クリーンアップ動作

---

## テスト実行手順

```bash
# 各テストの実行コマンド
# Test 1: レイテンシ
./tests/test_latency.sh

# Test 2: 負荷
./tests/test_load.sh

# Test 3: メモリ
./tests/test_memory.sh

# Test 4: エラー耐性
./tests/test_resilience.sh

# Test 5: 長時間
./tests/test_stability.sh
```

## 成功基準
- 全テストクリア
- レイテンシ < 期待値
- メモリリークなし
- エラー回復可能
